var clienttelemetry_build;!function(t){t.version="2.5.0"}(clienttelemetry_build||(clienttelemetry_build={}));var Microsoft;!function(t){!function(t){!function(t){t[t.BT_STOP=0]="BT_STOP",t[t.BT_STOP_BASE=1]="BT_STOP_BASE",t[t.BT_BOOL=2]="BT_BOOL",t[t.BT_UINT8=3]="BT_UINT8",t[t.BT_UINT16=4]="BT_UINT16",t[t.BT_UINT32=5]="BT_UINT32",t[t.BT_UINT64=6]="BT_UINT64",t[t.BT_FLOAT=7]="BT_FLOAT",t[t.BT_DOUBLE=8]="BT_DOUBLE",t[t.BT_STRING=9]="BT_STRING",t[t.BT_STRUCT=10]="BT_STRUCT",t[t.BT_LIST=11]="BT_LIST",t[t.BT_SET=12]="BT_SET",t[t.BT_MAP=13]="BT_MAP",t[t.BT_INT8=14]="BT_INT8",t[t.BT_INT16=15]="BT_INT16",t[t.BT_INT32=16]="BT_INT32",t[t.BT_INT64=17]="BT_INT64",t[t.BT_WSTRING=18]="BT_WSTRING",t[t.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(t.BondDataType||(t.BondDataType={}));t.BondDataType;!function(t){t[t.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",t[t.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",t[t.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",t[t.JSON_PROTOCOL=21322]="JSON_PROTOCOL",t[t.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",t[t.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL"}(t.ProtocolType||(t.ProtocolType={}));t.ProtocolType}(t.Bond||(t.Bond={}));t.Bond}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(t){!function(t){var e=function(){function t(){this._buffer=[]}return t.prototype.Add=function(t){for(var e=0;e<this._buffer.length&&this._buffer[e]!=t;++e);e==this._buffer.length&&this._buffer.push(t)},t.prototype.Count=function(){return this._buffer.length},t.prototype.GetBuffer=function(){return this._buffer},t}();t.Set=e;var n=function(){function t(){this._buffer=[]}return t.prototype.Add=function(t,e){-1==this._getIndex(t)&&this._buffer.push({Key:t,Value:e})},t.prototype.AddOrReplace=function(t,e){var n=this._getIndex(t);n>=0?this._buffer[n]={Key:t,Value:e}:this._buffer.push({Key:t,Value:e})},t.prototype.Remove=function(t){var e=this._getIndex(t);e>=0&&this._buffer.splice(e,1)},t.prototype.Count=function(){return this._buffer.length},t.prototype.GetBuffer=function(){return this._buffer},t.prototype.ContainsKey=function(t){return this._getIndex(t)>=0},t.prototype.Get=function(t){var e=this._getIndex(t);return e>=0?this._buffer[e].Value:null},t.prototype._getIndex=function(t){for(var e=0,n=-1;e<this._buffer.length;++e)if(this._buffer[e].Key==t){n=e;break}return n},t}();t.Map=n}(t.Collections||(t.Collections={}));t.Collections}(t.Bond||(t.Bond={}));t.Bond}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(e){!function(t){var i=function(){function t(){}return t.GetBytes=function(t){for(var e=[],n=0;n<t.length;++n){var i=t.charCodeAt(n);128>i?e.push(i):2048>i?e.push(192|i>>6,128|63&i):55296>i||i>=57344?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},t}();t.Utf8=i;var r=function(){function t(){}return t.GetString=function(t){var e,n,i,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[],s=t.length%3,a=function(t){return[r.charAt(t>>18&63),r.charAt(t>>12&63),r.charAt(t>>6&63),r.charAt(63&t)].join("")};for(e=0,i=t.length-s;i>e;e+=3)n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],o.push(a(n));switch(s){case 1:n=t[t.length-1],o.push(r.charAt(n>>2)),o.push(r.charAt(n<<4&63)),o.push("==");break;case 2:n=(t[t.length-2]<<8)+t[t.length-1],o.push(r.charAt(n>>10)),o.push(r.charAt(n>>4&63)),o.push(r.charAt(n<<2&63)),o.push("=")}return o.join("")},t}();t.Base64=r;var o=function(){function t(){}return t.GetBytes=function(t){for(var e=[];4294967168&t;)e.push(127&t|128),t>>>=7;return e.push(127&t),e},t}();t.Varint=o;var s=function(){function t(){}return t.GetBytes=function(t){for(var e=t.low,n=t.high,i=[];n||4294967168&e;)i.push(127&e|128),e=(127&n)<<25|e>>>7,n>>>=7;return i.push(127&e),i},t}();t.Varint64=s;var a=function(){function t(){}return t.GetBytes=function(t){if(e.BrowserChecker.IsDataViewSupport()){var i=new DataView(new ArrayBuffer(4));i.setFloat32(0,t,!0);for(var r=[],o=0;4>o;++o)r.push(i.getUint8(o));return r}return n.ConvertNumberToArray(t,!1)},t}();t.Float=a;var u=function(){function t(){}return t.GetBytes=function(t){if(e.BrowserChecker.IsDataViewSupport()){var i=new DataView(new ArrayBuffer(8));i.setFloat64(0,t,!0);for(var r=[],o=0;8>o;++o)r.push(i.getUint8(o));return r}return n.ConvertNumberToArray(t,!0)},t}();t.Double=u;var c=function(){function t(){}return t.EncodeZigzag16=function(t){return t=e.Number.ToInt16(t),t<<1^t>>15},t.EncodeZigzag32=function(t){return t=e.Number.ToInt32(t),t<<1^t>>31},t.EncodeZigzag64=function(t){var n=t.low,i=t.high,r=i<<1|n>>>31,o=n<<1;2147483648&i&&(r=~r,o=~o);var s=new e.UInt64("0");return s.low=o,s.high=r,s},t}();t.Zigzag=c}(e.Encoding||(e.Encoding={}));e.Encoding;!function(i){var r=function(){function t(){}return t.GetString=function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];if(191>=i)e.push(String.fromCharCode(i));else if(223>=i){var r=t[++n];e.push(String.fromCharCode((31&i)<<6|63&r))}else if(239>=i){var r=t[++n],o=t[++n];e.push(String.fromCharCode((15&i)<<12|(63&r)<<6|63&o))}else{var r=t[++n],o=t[++n],s=t[++n];i=(7&i)<<18|(63&r)<<12|(63&o)<<6|63&s,i-=65536,e.push(String.fromCharCode(55296|i>>10&1023)),e.push(String.fromCharCode(56320|1023&i))}}return e.join("")},t}();i.Utf8=r;var o=function(){function t(){}return t.GetBytes=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],i=0;i<t.length;++i){var r=e.indexOf(t.charAt(i++)),o=e.indexOf(t.charAt(i++)),s=e.indexOf(t.charAt(i++)),a=e.indexOf(t.charAt(i));n.push(r<<2|o>>4),s>=0&&(n.push(o<<4&240|s>>2),a>=0&&n.push(s<<6&192|a))}return n},t}();i.Base64=o;var s=function(){function e(){}return e.GetInt64=function(e){var n=new t.Bond.Int64("0"),i=this._Read(e);return n.low=i[0],i.length>1&&(n.high=i[1]),n},e.GetNumber=function(t){return this._Read(t)[0]},e._Read=function(t){for(var e=[],n=0,i=!0,r=0;i;){var o=t.shift();if(i=0!=(128&o),o=127&o,!(28>r)){n|=o<<r,e.push(n),n=o>>4,r=3;break}n|=o<<r,r+=7}for(;i;){var o=t.shift();if(i=0!=(128&o),o=127&o,n|=o<<r,r+=7,r>=32)break}return e.push(n),e},e}();i.Varint=s;var a=function(){function t(){}return t.GetNumber=function(t){if(e.BrowserChecker.IsDataViewSupport()){for(var i=new DataView(new ArrayBuffer(4)),r=0;4>r;++r)i.setUint8(r,t[r]);return i.getFloat32(0,!0)}return n.ConvertArrayToNumber(t,!1)},t}();i.Float=a;var u=function(){function t(){}return t.GetNumber=function(t){if(e.BrowserChecker.IsDataViewSupport()){for(var i=new DataView(new ArrayBuffer(8)),r=0;8>r;++r)i.setUint8(r,t[r]);return i.getFloat64(0,!0)}return n.ConvertArrayToNumber(t,!0)},t}();i.Double=u;var c=function(){function e(){}return e.DecodeZigzag16=function(t){return((65535&t)>>>1^-(1&t))<<16>>16},e.DecodeZigzag32=function(t){return t>>>1^-(1&t)},e.DecodeZigzag64=function(e){var n=1&e.high,i=e.high>>>1,r=1&e.low,o=e.low>>>1;o=n<<31|o,r&&(o^=4294967295,i^=4294967295);var s=new t.Bond.UInt64("0");return s.low=o,s.high=i,s},e}();i.Zigzag=c}(e.Decoding||(e.Decoding={}));var n=(e.Decoding,function(){function t(){}return t.ConvertNumberToArray=function(t,e){if(!t)return e?this._doubleZero:this._floatZero;var n=e?11:8,i=e?52:23,r=(1<<n-1)-1,o=1-r,s=r,a=0>t?1:0;t=Math.abs(t);for(var u=Math.floor(t),c=t-u,l=2*(r+2)+i,h=new Array(l),f=0;l>f;)h[f++]=0;for(f=r+2;f&&u;)h[--f]=u%2,u=Math.floor(u/2);for(f=r+1;l-1>f&&c>0;)c*=2,c>=1?(h[++f]=1,--c):h[++f]=0;for(var d=0;l>d&&!h[d];++d);var _=r+1-d,p=d+i;if(h[p+1]){for(f=p;f>d&&!(h[f]=1-h[f]);--f);f==d&&++_}if(_>s||u)return a?e?this._doubleNegInifinity:this._floatNegInifinity:e?this._doubleInifinity:this._floatInifinity;if(o>_)return e?this._doubleZero:this._floatZero;if(e){var g=0;for(f=0;20>f;++f)g=g<<1|h[++d];for(var I=0;52>f;++f)I=I<<1|h[++d];g|=_+r<<20,g=a<<31|2147483647&g;var E=[255&I,I>>8&255,I>>16&255,I>>>24,255&g,g>>8&255,g>>16&255,g>>>24];return E}var S=0;for(f=0;23>f;++f)S=S<<1|h[++d];S|=_+r<<23,S=a<<31|2147483647&S;var E=[255&S,S>>8&255,S>>16&255,S>>>24];return E},t.ConvertArrayToNumber=function(t,n){var i=n?11:8,r=(1<<i-1)-1,o=0!=(128&t[n?7:3]),s=n?(127&t[7])<<4|(240&t[6])>>4:(127&t[3])<<1|(128&t[2])>>7;if(255==s)throw new e.Exception("Not a valid float/double buffer.");var a=1,u=1;if(n){var c=(15&t[6])<<28|(255&t[5])<<20|(255&t[4])<<12,l=t[3]<<24|(255&t[2])<<16|(255&t[1])<<8|255&t[0];if(!s&&!c&&!l)return 0;for(var h=0;20>h;++h)u/=2,0>c&&(a+=u),c<<=1;for(var h=0;32>h;++h)u/=2,0>l&&(a+=u),l<<=1}else{var f=(127&t[2])<<25|(255&t[1])<<17|(255&t[0])<<9;if(!s&&!f)return 0;for(var h=0;23>h;++h)u/=2,0>f&&(a+=u),f<<=1}return a*=Math.pow(2,s-r),o?0-a:a},t._floatZero=[0,0,0,0],t._doubleZero=[0,0,0,0,0,0,0,0],t._floatInifinity=[0,0,128,127],t._floatNegInifinity=[0,0,128,255],t._doubleInifinity=[0,0,0,0,0,0,240,127],t._doubleNegInifinity=[0,0,0,0,0,0,240,255],t}())}(t.Bond||(t.Bond={}));t.Bond}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(t){!function(e){var n=function(){function e(){this._buffer=[]}return e.prototype.WriteByte=function(e){this._buffer.push(t.Number.ToByte(e))},e.prototype.Write=function(t,e,n){for(;n--;)this.WriteByte(t[e++])},e.prototype.GetBuffer=function(){return this._buffer},e}();e.MemoryStream=n}(t.IO||(t.IO={}));t.IO}(t.Bond||(t.Bond={}));t.Bond}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(t){var e=function(){function t(t,e){this.Type=t,this.Id=e}return t}();t.FieldTag=e;var n=function(){function t(t,e){this.ElementType=t,this.Size=e}return t}();t.ContainerTag=n;var i=function(){function t(t,e,n){this.KeyType=t,this.ValueType=e,this.Size=n}return t}();t.KeyValueContainerTag=i;var r=function(){function t(){}return t}();t.Bonded=r;var o=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t),this.low<0&&(this.high=-1)}return t.prototype.Equals=function(e){var n=new t(e);return this.low==n.low&&this.high==n.high},t}();t.Int64=o;var s=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t)}return t.prototype.Equals=function(e){var n=new t(e);return this.low==n.low&&this.high==n.high},t}();t.UInt64=s;var a=function(){function t(){}return t.ToByte=function(t){return this.ToUInt8(t)},t.ToInt8=function(t){var e=(128&t)<<24>>24;return 127&t|e},t.ToInt16=function(t){var e=(32768&t)<<16>>16;return 32767&t|e},t.ToInt32=function(t){var e=2147483648&t;return 2147483647&t|e},t.ToUInt8=function(t){return 255&t},t.ToUInt16=function(t){return 65535&t},t.ToUInt32=function(t){return 4294967295&t},t}();t.Number=a;var u=function(){function t(t){this.Message=t}return t}();t.Exception=u;var c=function(){function t(){}return t}();t.KeyValuePair=c;var l=function(){function t(){}return t.IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},t}();t.BrowserChecker=l}(t.Bond||(t.Bond={}));t.Bond}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(t){var e=function(){function e(t){this._stream=t}return e.prototype.WriteBlob=function(t){this._stream.Write(t,0,t.length)},e.prototype.WriteBool=function(t){this._stream.WriteByte(t?1:0)},e.prototype.WriteContainerBegin=function(t,e){this.WriteUInt8(e),this.WriteUInt32(t)},e.prototype.WriteMapContainerBegin=function(t,e,n){this.WriteUInt8(e),this.WriteUInt8(n),this.WriteUInt32(t)},e.prototype.WriteContainerEnd=function(){},e.prototype.WriteDouble=function(e){var n=t.Encoding.Double.GetBytes(e);this._stream.Write(n,0,n.length)},e.prototype.WriteFloat=function(e){var n=t.Encoding.Float.GetBytes(e);this._stream.Write(n,0,n.length)},e.prototype.WriteFieldBegin=function(t,e,n){5>=e?this._stream.WriteByte(t|e<<5):255>=e?(this._stream.WriteByte(192|t),this._stream.WriteByte(e)):(this._stream.WriteByte(224|t),this._stream.WriteByte(e),this._stream.WriteByte(e>>8))},e.prototype.WriteFieldEnd=function(){},e.prototype.WriteFieldOmitted=function(t,e,n){},e.prototype.WriteInt16=function(e){e=t.Encoding.Zigzag.EncodeZigzag16(e),this.WriteUInt16(e)},e.prototype.WriteInt32=function(e){e=t.Encoding.Zigzag.EncodeZigzag32(e),this.WriteUInt32(e)},e.prototype.WriteInt64=function(e){this.WriteUInt64(t.Encoding.Zigzag.EncodeZigzag64(e))},e.prototype.WriteInt8=function(e){this._stream.WriteByte(t.Number.ToInt8(e))},e.prototype.WriteString=function(e){if(""==e)this.WriteUInt32(0);else{var n=t.Encoding.Utf8.GetBytes(e);this.WriteUInt32(n.length),this._stream.Write(n,0,n.length)}},e.prototype.WriteStructBegin=function(t,e){},e.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?1:0)},e.prototype.WriteUInt16=function(e){var n=t.Encoding.Varint.GetBytes(t.Number.ToUInt16(e));this._stream.Write(n,0,n.length)},e.prototype.WriteUInt32=function(e){var n=t.Encoding.Varint.GetBytes(t.Number.ToUInt32(e));this._stream.Write(n,0,n.length)},e.prototype.WriteUInt64=function(e){var n=t.Encoding.Varint64.GetBytes(e);this._stream.Write(n,0,n.length)},e.prototype.WriteUInt8=function(e){this._stream.WriteByte(t.Number.ToUInt8(e))},e.prototype.WriteWString=function(t){this.WriteUInt32(t.length);for(var e=0;e<t.length;++e){var n=t.charCodeAt(e);this._stream.WriteByte(n),this._stream.WriteByte(n>>>8)}},e}();t.CompactBinaryProtocolWriter=e;var n=function(){function t(){}return t}();t.CompactBinaryProtocolReader=n}(t.Bond||(t.Bond={}));t.Bond}(Microsoft||(Microsoft={}));var sct;!function(t){var e=function(){function t(){}return t.IsSafari=function(){return null===t._isSafari&&t._DetectBrowser(),t._isSafari},t.ajax=function(e){var n=t._createConnection();if(e.headers){var i="qsp=true";for(var r in e.headers)i+="&",i+=encodeURIComponent(r),i+="=",i+=encodeURIComponent(e.headers[r]);e.url+=e.url.indexOf("?")<0?"?":"&",e.url+=i}n.open(e.type,e.url),e.complete&&(n.onload=function(){"undefined"==typeof n.status&&(n.status=200),e.complete(n)},n.ontimeout=function(){"undefined"==typeof n.status&&(n.status=500),e.complete(n)},n.onerror=function(){e.complete(n)}),n.send(e.data)},t.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},t.IsUsingXDomainRequest=function(){if(null==t._usingXDomainRequest){var e=new XMLHttpRequest;t._usingXDomainRequest="undefined"==typeof e.withCredentials&&"undefined"!=typeof XDomainRequest}return t._usingXDomainRequest},t._createConnection=function(){var e=new XMLHttpRequest;return t.IsUsingXDomainRequest()?new XDomainRequest:e},t._DetectBrowser=function(){var e=navigator.userAgent.toLowerCase();t._isSafari=e.indexOf("safari")>=0&&e.indexOf("chrome")<0},t._isSafari=null,t._usingXDomainRequest=null,t}();t.Utils=e}(sct||(sct={}));var microsoft;!function(t){!function(t){!function(t){!function(e){var n=function(){function t(){}return t.GetGuid=function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1,5)};return[t(),t(),"-",t(),"-",t(),"-",t(),"-",t(),t(),t()].join("")},t.GetTimeStamp=function(){var t=(new Date).getTime(),e=new Microsoft.Bond.Int64("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e},t.GetTimeStampWithValue=function(t){var e=new Microsoft.Bond.Int64("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e},t}();e.utils=n,function(t){t[t.NotSet=0]="NotSet",t[t.Event=1]="Event",t[t.PerformanceCounter=2]="PerformanceCounter",t[t.Anomaly=3]="Anomaly",t[t.Prediction=4]="Prediction",t[t.TraceLog=5]="TraceLog",t[t.EventSourceLog=6]="EventSourceLog",t[t.HttpLog=7]="HttpLog",t[t.PerformanceCounterAzure=8]="PerformanceCounterAzure",t[t.PerformanceCounterGfs=9]="PerformanceCounterGfs"}(e.RecordType||(e.RecordType={}));e.RecordType;!function(t){t[t.NotSet=0]="NotSet",t[t.O365=1]="O365",t[t.SkypeBI=2]="SkypeBI",t[t.SkypeData=3]="SkypeData"}(e.PIIScrubber||(e.PIIScrubber={}));e.PIIScrubber;!function(t){t[t.NotSet=0]="NotSet",t[t.DistinguishedName=1]="DistinguishedName",t[t.GenericData=2]="GenericData",t[t.IPV4Address=3]="IPV4Address",t[t.IPv6Address=4]="IPv6Address",t[t.MailSubject=5]="MailSubject",t[t.PhoneNumber=6]="PhoneNumber",t[t.QueryString=7]="QueryString",t[t.SipAddress=8]="SipAddress",t[t.SmtpAddress=9]="SmtpAddress",t[t.Identity=10]="Identity",t[t.Uri=11]="Uri",t[t.Fqdn=12]="Fqdn",t[t.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(e.PIIKind||(e.PIIKind={}));var i=(e.PIIKind,function(){function t(){this.ScrubType=0,this.Kind=0,this.RawContent=""}return t.prototype.Write=function(t){this.WriteImpl(t,!1)},t.prototype.WriteImpl=function(t,e){t.WriteStructBegin(null,e),0!=this.ScrubType?(t.WriteFieldBegin(16,1,null),t.WriteInt32(this.ScrubType),t.WriteFieldEnd()):t.WriteFieldOmitted(16,1,null),0!=this.Kind?(t.WriteFieldBegin(16,2,null),t.WriteInt32(this.Kind),t.WriteFieldEnd()):t.WriteFieldOmitted(16,2,null),""!=this.RawContent?(t.WriteFieldBegin(9,3,null),t.WriteString(this.RawContent),t.WriteFieldEnd()):t.WriteFieldOmitted(9,3,null),t.WriteStructEnd(e)},t.prototype.Read=function(t){this.ReadImpl(t,!1)},t.prototype.ReadImpl=function(t,e){},t}());e.PII=i;var r=function(){function e(){this.Id=n.GetGuid(),this.Timestamp=n.GetTimeStamp(),this.Type="",this.EventType="",this.Extension=new Microsoft.Bond.Collections.Map,this.RecordType=0,this.PIIExtensions=new Microsoft.Bond.Collections.Map}return e.prototype.AddOrReplacePII=function(e,n,i){var r=new t.datamodels.PII;r.RawContent=n,r.Kind=i,r.ScrubType=1,this.PIIExtensions.AddOrReplace(e,r)},e.prototype.Write=function(t){this.WriteImpl(t,!1)},e.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),""!=this.Id?(t.WriteFieldBegin(9,1,null),t.WriteString(this.Id),t.WriteFieldEnd()):t.WriteFieldOmitted(9,1,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(17,3,null):(t.WriteFieldBegin(17,3,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),""!=this.Type?(t.WriteFieldBegin(9,5,null),t.WriteString(this.Type),t.WriteFieldEnd()):t.WriteFieldOmitted(9,5,null),""!=this.EventType?(t.WriteFieldBegin(9,6,null),t.WriteString(this.EventType),t.WriteFieldEnd()):t.WriteFieldOmitted(9,6,null),this.Extension.Count()){t.WriteFieldBegin(13,13,null),t.WriteMapContainerBegin(this.Extension.Count(),9,9);for(var n=0;n<this.Extension.GetBuffer().length;++n)t.WriteString(this.Extension.GetBuffer()[n].Key),t.WriteString(this.Extension.GetBuffer()[n].Value);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(13,13,null);if(0!=this.RecordType?(t.WriteFieldBegin(16,24,null),t.WriteInt32(this.RecordType),t.WriteFieldEnd()):t.WriteFieldOmitted(16,24,null),this.PIIExtensions.Count()){t.WriteFieldBegin(13,30,null),t.WriteMapContainerBegin(this.PIIExtensions.Count(),9,10);for(var i=0;i<this.PIIExtensions.GetBuffer().length;++i)t.WriteString(this.PIIExtensions.GetBuffer()[i].Key),this.PIIExtensions.GetBuffer()[i].Value.WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(13,30,null);t.WriteStructEnd(e)},e.prototype.Read=function(t){this.ReadImpl(t,!1)},e.prototype.ReadImpl=function(t,e){},e}();e.Record=r;var o=function(){function t(){this.Source="",this.DataPackageId="",this.Timestamp=new Microsoft.Bond.Int64("0"),this.Records=[]}return t.prototype.Write=function(t){this.WriteImpl(t,!1)},t.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),""!=this.Source?(t.WriteFieldBegin(9,2,null),t.WriteString(this.Source),t.WriteFieldEnd()):t.WriteFieldOmitted(9,2,null),""!=this.DataPackageId?(t.WriteFieldBegin(9,5,null),t.WriteString(this.DataPackageId),t.WriteFieldEnd()):t.WriteFieldOmitted(9,5,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(17,6,null):(t.WriteFieldBegin(17,6,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),this.Records.length){t.WriteFieldBegin(11,8,null),t.WriteContainerBegin(this.Records.length,10);for(var n=0;n<this.Records.length;++n)this.Records[n].WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(11,8,null);t.WriteStructEnd(e)},t.prototype.Read=function(t){this.ReadImpl(t,!1)},t.prototype.ReadImpl=function(t,e){},t}();e.DataPackage=o;var s=function(){function t(){this.DataPackages=[],this.RequestRetryCount=0}return t.prototype.Write=function(t){this.WriteImpl(t,!1)},t.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),this.DataPackages.length){t.WriteFieldBegin(11,1,null),t.WriteContainerBegin(this.DataPackages.length,10);for(var n=0;n<this.DataPackages.length;++n)this.DataPackages[n].WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(11,1,null);0!=this.RequestRetryCount?(t.WriteFieldBegin(16,2,null),t.WriteInt32(this.RequestRetryCount),t.WriteFieldEnd()):t.WriteFieldOmitted(16,2,null),t.WriteStructEnd(e)},t.prototype.Read=function(t){this.ReadImpl(t,!1)},t.prototype.ReadImpl=function(t,e){},t}();e.ClientToCollectorRequest=s}(t.datamodels||(t.datamodels={}));t.datamodels}(t.telemetry||(t.telemetry={}));t.telemetry}(t.applications||(t.applications={}));t.applications}(microsoft||(microsoft={}));var microsoft;!function(t){!function(t){!function(t){!function(e){!function(t){t[t.SENT=0]="SENT",t[t.SEND_FAILED=1]="SEND_FAILED"}(e.CallbackEventType||(e.CallbackEventType={}));e.CallbackEventType;!function(t){t[t.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",t[t.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",t[t.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",t[t.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",t[t.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",t[t.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"}(e.DATARV_ERROR||(e.DATARV_ERROR={}));var n=(e.DATARV_ERROR,function(){function t(t){this._errorCode=0,this._errorCode=t}return t.prototype.ErrorCode=function(){return this._errorCode},t.prototype.toString=function(){switch(this._errorCode){case 0:return"DATARV_ERROR_OK";case 1:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case 2:return"Invalid configuration. CollectorUrl is missing.";case 3:return"DATARV_ERROR_INVALID_DEPENDENCIES";case 4:return"Telemetry Manager is not initialized.";case 5:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}},t}());e.Exception=n;var i=function(){function t(){}return t}();e.TelemetryConfig=i;var r=function(){function t(){}return t.CreateTelemetryManager=function(){return new a},t}();e.TelemetryManagerFactory=r;var o,s=function(){function t(){}return t.MaxPackageSizeInBytes=function(){return 3e6},t.TimeIntervalForNextSendInMS=function(){return 1e3},t}();!function(t){t[t.Created=0]="Created",t[t.Initialized=1]="Initialized",t[t.Started=2]="Started"}(o||(o={}));var a=function(){function e(){this._MaxPackageSizeInBytes=s.MaxPackageSizeInBytes(),this._listeners=[],this._status=0,this._ecsClient=null,this._etag=null,this._ecsCallback=null,this._testServerResponseHook=null}return e.prototype.Initialize=function(t){if(0!=this._status)throw new n(4);if(!t||!t.collectorUrl)throw new n(2);this._config=t,this._Reset(),this._status=1,t.ecsClient&&(this._Verbose("ECS object assigned. Do integration"),this._ecsClient=t.ecsClient),this._Verbose("Initialize() done")},e.prototype.AddListener=function(t){if(this._status<1)throw new n(4);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",t].join(""));for(var e=0;e<this._listeners.length;++e)if(this._listeners[e]==t)return void this._Verbose("the listener has been added already, index: "+e);this._listeners.push(t),this._Verbose("AddListener() done, the new length: "+this._listeners.length)},e.prototype.RemoveListener=function(t){if(this._status<1)throw new n(4);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",t].join(""));for(var e=0;e<this._listeners.length;++e)if(this._listeners[e]==t)return 1==this._listeners.length?this._listeners=[]:e==this._listeners.length-1?this._listeners.pop():this._listeners[e]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",e,"new length: ",this._listeners.length].join(""));this._Verbose("listener isn't been found, new length"+this._listeners.length)},e.prototype.Start=function(){if(this._status<1)throw new n(4);this._Verbose(["Start(), status:",this._status,"tag:",e._tag].join(" ")),this._status>=2&&this._Verbose("Start() already, ignore"),this._ecsClient&&(this._ecsCallback=this._CreateEcsCallback(),this._ecsClient.AddListener(this._ecsCallback),this._etag=this._ecsClient.GetETag()),++e._tag,this._status=2,this._Verbose(["Start() done, status: ",this._status,"tag: ",e._tag].join(""))},e.prototype.Stop=function(){if(this._status<1)throw new n(4);return this._Verbose("Stop(), status: "+this._status),1==this._status?void this._Verbose("Stop() already, ignore"):(this._Reset(),this._status=1,void this._Verbose("Stop() done, status: "+this._status))},e.prototype.Flush=function(t){this._eventsCache.IsEmpty()||this._WorkThread(t)},e.prototype.SendAsync=function(t,i){if(this._status<1)throw new n(4);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",t,"count:",i.length].join(" ")),this._status<2)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!t||!i)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new n(5);for(var r=0;r<i.length;++r)if(!i[r].Id||!e._eventTypeRegex.test(i[r].EventType)||i[r].Timestamp.Equals("0"))throw this._Error(["eventId:",i[r].Id,"eventType:",i[r].EventType,"timestamp high:",i[r].Timestamp.high,"timestamp low:",i[r].Timestamp.low].join("")),new n(1);return this._eventsCache.AddEvents(t,i),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0},e.prototype._WorkThread=function(t){var n=this;try{if(this._Verbose("_WorkThread, status: "+this._status),this._status<2)return void this._Verbose("_WorkThread, status is not started, return");var i=this._eventsCache.DequeuEvents();if(null==i)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();var r=this._PackEvents(i.tenantToken,i.events);if(this._eventsCache.AddEvents(i.tenantToken,r.remainedEvents),null==r.buffer||0==r.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testServerResponseHook){var o=this._testServerResponseHook();return void setTimeout(this._SendCallback(a,i.tenantToken,r.sendEvents,o,null),100)}var s={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+clienttelemetry_build.version},complete:function(e){return n._SendCallback(a,i.tenantToken,r.sendEvents,e,t)}};sct.Utils.IsSafari()||"undefined"==typeof Uint8Array?(this._Verbose("Uint8Array is undefined, send with base64 encode."),s.data=Microsoft.Bond.Encoding.Base64.GetString(r.buffer),s.headers["content-encoding"]="base64"):(this._Verbose("Uint8Array is defined, send with binary format directly."),s.data=new Uint8Array(r.buffer)),i.tenantToken&&(s.headers["x-apikey"]=i.tenantToken);var a=e._tag;this._lastActiveTime=(new Date).getTime(),sct.Utils.ajax(s),this._Verbose("_Workthread, send via jquery, tag: "+a)}catch(u){this._Error("_WorkThread, exception: "+u)}},e.prototype._PackEvents=function(e,n){this._Verbose("_PackageEvents, total Count: "+n.length);var i=new t.datamodels.ClientToCollectorRequest,r=new t.datamodels.DataPackage;r.Source="JS_default_source",r.DataPackageId=t.datamodels.utils.GetGuid(),r.Timestamp=t.datamodels.utils.GetTimeStamp();var o,s=n;for(n=[];r.Records=[],r.Records.push.apply(r.Records,s),i.DataPackages=[],i.DataPackages.push(r),o=this._Serialize(i),this._Verbose(["_PackageEvents, sendEvents.length:",s.length,"buffer.length:",o.length,"MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),!(o.length<this._MaxPackageSizeInBytes);){if(1==s.length){s=[],o=null;break}var a=s.splice(0,Math.floor(s.length/2));this._Verbose("_PackageEvents, too large, package again"),n.push.apply(n,s),s=a}return this._Verbose(["_PakcageEvents done, sendEventsCount:",s.length,"buffer.length:",null==o?0:o.length,"remained events:",n.length].join("")),{buffer:o,sendEvents:s,remainedEvents:n}},e.prototype._Serialize=function(t){var e=new Microsoft.Bond.IO.MemoryStream,n=new Microsoft.Bond.CompactBinaryProtocolWriter(e);return t.Write(n),e.GetBuffer()},e.prototype._SendCallback=function(t,n,i,r,o){if(this._Verbose(["_SendCallback","tag:",t,"current tag:",e._tag,"tenantToken:",n,"events count:",i.length,"jqXHR:",r].join("")),null!=o)return void o(r?r.status:0,n,i);var s=null!=r&&r.status>=200&&r.status<300;if(this._status<2||t<e._tag)return void this._Verbose("_SendCallback, is not started, or tag is not the same, return");if(!s&&(!r||r.status&&400!=r.status))return this._Verbose("retry statusCode: "+(r?r.status:0)),this._eventsCache.AddEvents(n,i),void this._ScheduleTimer(!0);for(var a=0;a<this._listeners.length;++a)this._listeners[a](s?0:1,r?r.status:0,n,i);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))},e.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)},e.prototype._ScheduleTimer=function(t){var e=this;if(this._Verbose("_ScheduleTimer: isRetry: "+t),this._CleanTimer(),t){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);var n=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(function(){return e._WorkThread(null)},1e3*n),this._Verbose("_ScheduleTimer, next try (s): "+n),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}else{var n=0,i=(new Date).getTime(),r=i-this._lastActiveTime;n=r>s.TimeIntervalForNextSendInMS()?0:s.TimeIntervalForNextSendInMS()-r,this._timer=setTimeout(function(){return e._WorkThread(null)},n),this._Verbose("_ScheduleTimer, next try: "+n),this._rescheduleFactor=1}},e.prototype._Verbose=function(t){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+t)},e.prototype._Info=function(t){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+t)},e.prototype._Error=function(t){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+t)},e.prototype._Reset=function(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new u,this._ecsClient&&(this._ecsClient.RemoveListener(this._ecsCallback),this._ecsCallback=null)},e.prototype._CreateEcsCallback=function(){var t=this;return function(e){0==e&&(t._etag=t._ecsClient.GetETag())}},e.prototype.__GetListenerArray=function(){return this._listeners},e.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount()},e.prototype.__IsScheduled=function(){return null!=this._timer},e.prototype.__ChageMaxPackageSizeInKB=function(t){this._MaxPackageSizeInBytes=1024*t},e.prototype.__SetTestServerResponseHook=function(t){this._testServerResponseHook=t},e._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,e._tag=0,e}(),u=function(){function t(){this._events={},this._tokens=[]}return t.prototype.AddEvents=function(t,e){e.length&&(this._events[t]||(this._events[t]=[],this._tokens.push(t)),this._events[t].push.apply(this._events[t],e))},t.prototype.IsEmpty=function(){return 0==this._tokens.length},t.prototype.DequeuEvents=function(){if(0==this._tokens.length)return null;var t=this._tokens.shift(),e=this._events[t];return delete this._events[t],{tenantToken:t,events:e}},t.prototype.GetTotalEventsCount=function(){var t=0;for(var e in this._events)t+=this._events[e].length;return t},t}()}(t._sender||(t._sender={}));t._sender}(t.telemetry||(t.telemetry={}));t.telemetry}(t.applications||(t.applications={}));t.applications}(microsoft||(microsoft={}));var microsoft;!function(t){!function(t){!function(t){var e=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),n=function(){function t(){this.collectorUrl=null;
}return t}();t.LogConfiguration=n;var i=function(){function e(){this.key=null,this.value=null,this.pii=null}return e._isPii=function(e){if(0==e)return!1;var n=!1;for(var i in t.datamodels.PIIKind)isNaN(i)||i==e&&(n=!0);return n},e}();t.Property=i;var r=function(){function t(){this.name=null,this.timestamp=null,this.properties=[],this.eventType=null}return t.prototype.setProperty=function(e,n,i){if(!e||!t._propertyNameRegex.test(e))throw new o(3);this.properties.push(i?{key:e,value:n,pii:0!=i?i:null}:{key:e,value:n,pii:null})},t._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_]){0,98}[a-zA-Z0-9])?$/,t}();t.EventProperties=r,function(t){t[t.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN",t[t.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME",t[t.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME",t[t.INVALID_COLLECTOR_URL=4]="INVALID_COLLECTOR_URL",t[t.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE",t[t.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL",t[t.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID",t[t.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME",t[t.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE"}(t.TelemetryError||(t.TelemetryError={}));var o=(t.TelemetryError,function(){function t(t){this.errorCode=null,this.errorCode=t}return t.prototype.ErrorCode=function(){return this.errorCode},t.prototype.toString=function(){switch(this.errorCode){case 1:return"Invalid tenant token";case 2:return"Eventproperties.name can not be null or empty";case 3:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_]){0,98}[a-zA-Z0-9])?$";case 4:return"Collector url can't be null or empty.";case 5:return"Failure signature can't be null or empty.";case 6:return"Failure detail can't be null or empty.";case 7:return"Pageview id can't be null or empty.";case 8:return"Pageview name can't be null or empty.";case 9:return"Session state has to be a value from the SessionState enum.";default:return"Unknown error"}},t}());t.Exception=o;var s=function(){function t(t){this.contextMap=new Microsoft.Bond.Collections.Map,this.piiKind=0,this._allowDeviceInfoFields=!1,this._allowDeviceInfoFields=t}return t.prototype.setAppId=function(t){t&&this.contextMap.Add("AppInfo.Id",t)},t.prototype.setAppVersion=function(t){t&&this.contextMap.Add("AppInfo.Version",t)},t.prototype.setAppLanguage=function(t){t&&this.contextMap.Add("AppInfo.Language",t)},t.prototype.setDeviceId=function(t){t&&this._allowDeviceInfoFields&&(this.contextMap.Add("DeviceInfo.Id",t),a.checkAndUpdateDeviceId(t))},t.prototype.setDeviceOsName=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.OsName",t)},t.prototype.setDeviceOsVersion=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.OsVersion",t)},t.prototype.setDeviceBrowserName=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.BrowserName",t)},t.prototype.setDeviceBrowserVersion=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.BrowserVersion",t)},t.prototype.setUserId=function(t,e){t&&this.contextMap.Add("UserInfo.Id",t),i._isPii(e)&&(this.piiKind=e)},t.prototype.setUserMsaId=function(t){t&&this.contextMap.Add("UserInfo.MsaId",t)},t.prototype.setUserANID=function(t){t&&this.contextMap.Add("UserInfo.ANID",t)},t.prototype.setUserAdvertisingId=function(t){t&&this.contextMap.Add("UserInfo.AdvertisingId",t)},t.prototype.setUserTimeZone=function(t){t&&this.contextMap.Add("UserInfo.TimeZone",t)},t.prototype.setUserLanguage=function(t){t&&this.contextMap.Add("UserInfo.Language",t)},t}(),a=function(){function e(){}return e.initialize=function(){var n=document.documentElement.lang;n&&e.semanticContext.setAppLanguage(n);var i=window.navigator.userLanguage||window.navigator.language;i&&e.semanticContext.setUserLanguage(i);var r=(new Date).getTimezoneOffset(),o=r%60,s=(r-o)/60,a="+";s>0&&(a="-"),e.semanticContext.setUserTimeZone(a+(10>s?"0"+s:s.toString())+":"+(10>o?"0"+o:o.toString())),e.semanticContext.setDeviceBrowserName(e._getBrowserName()),e.semanticContext.setDeviceBrowserVersion(e._getBrowserVersion()),e.semanticContext.setDeviceOsName(e._getOsName()),e.semanticContext.setDeviceOsVersion(e._getOsVersion());var u=e._getCookie(e.DEVICE_ID_COOKIE);""==u&&(u=t.datamodels.utils.GetGuid()),e.semanticContext.setDeviceId(u)},e.checkAndUpdateDeviceId=function(t){var n=e._getCookie(e.DEVICE_ID_COOKIE);n!=t&&(e._setCookie(e.DEVICE_ID_COOKIE,t),e._setCookie(e.FIRST_LAUNCH_TIME_COOKIE,(new Date).getTime().toString()));var i=e._getCookie(e.FIRST_LAUNCH_TIME_COOKIE);e.firstLaunchTime=parseInt(i)},e._setCookie=function(t,e){var n="expires=Mon, 31 Dec 2018 23:59:59 GMT";document.cookie=t+"="+e+"; "+n},e._getCookie=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i],o=0;" "==r.charAt(o);)o++;if(r=r.substring(o),0==r.indexOf(e))return r.substring(e.length,r.length)}return""},e._getUserAgent=function(){return window.navigator.userAgent},e._userAgentContainsString=function(t){return e._getUserAgent().indexOf(t)>-1},e._isIe=function(){return e._userAgentContainsString("Trident")},e._isEdge=function(){return e._userAgentContainsString(e.BROWSERS.EDGE)},e._isOpera=function(){return e._userAgentContainsString("OPR/")},e._getBrowserName=function(){return e._isOpera()?e.BROWSERS.UNKNOWN:e._userAgentContainsString(e.BROWSERS.PHANTOMJS)?e.BROWSERS.PHANTOMJS:e._isEdge()?e.BROWSERS.EDGE:e._userAgentContainsString(e.BROWSERS.ELECTRON)?e.BROWSERS.ELECTRON:e._userAgentContainsString(e.BROWSERS.CHROME)?e.BROWSERS.CHROME:e._userAgentContainsString(e.BROWSERS.FIREFOX)?e.BROWSERS.FIREFOX:e._userAgentContainsString(e.BROWSERS.SAFARI)?e.BROWSERS.SAFARI:e._userAgentContainsString(e.BROWSERS.SKYPE_SHELL)?e.BROWSERS.SKYPE_SHELL:e._isIe()?e.BROWSERS.MSIE:e.BROWSERS.UNKNOWN},e._getBrowserVersion=function(){function t(){var t,n=e._getUserAgent(),i=n.match(new RegExp(e.BROWSERS.MSIE+" "+e.REGEX_VERSION));return i?i[1]:(t=n.match(new RegExp("rv:"+e.REGEX_VERSION)))?t[1]:void 0}function n(t){var n;return t===e.BROWSERS.SAFARI&&(t="Version"),n=e._getUserAgent().match(new RegExp(t+"/"+e.REGEX_VERSION)),n?n[1]:e.UNKNOWN_VERSION}return e._isIe()?t():n(e._getBrowserName())},e._getOsName=function(){var t=/(windows|win32)/i,n=/ arm;/i,i=/windows\sphone\s\d+\.\d+/i,r=/(macintosh|mac os x)/i,o=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,s=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,a=/android/i;return e._getUserAgent().match(i)?e.OPERATING_SYSTEMS.WINDOWS_PHONE:e._getUserAgent().match(n)?e.OPERATING_SYSTEMS.WINDOWS_RT:e._getUserAgent().match(o)?e.OPERATING_SYSTEMS.IOS:e._getUserAgent().match(a)?e.OPERATING_SYSTEMS.ANDROID:e._getUserAgent().match(s)?e.OPERATING_SYSTEMS.LINUX:e._getUserAgent().match(r)?e.OPERATING_SYSTEMS.MACOSX:e._getUserAgent().match(t)?e.OPERATING_SYSTEMS.WINDOWS:e.OPERATING_SYSTEMS.UNKNOWN},e._getOsVersion=function(){function t(){var t=e._getUserAgent().match(new RegExp("Windows NT "+e.REGEX_VERSION));return t&&e.VERSION_MAPPINGS[t[1]]?e.VERSION_MAPPINGS[t[1]]:e.UNKNOWN_VERSION}function n(){var t=e._getUserAgent().match(new RegExp(e.OPERATING_SYSTEMS.MACOSX+" "+e.REGEX_VERSION_MAC));if(t){var n=t[1].replace(/_/g,"."),r=[];if(n){var o=i(n);return o?(r=n.split(o),r[0]):n}}return e.UNKNOWN_VERSION}function i(t){return t.indexOf(".")>-1?".":t.indexOf("_")>-1?"_":null}return e._getOsName()===e.OPERATING_SYSTEMS.WINDOWS?t():e._getOsName()===e.OPERATING_SYSTEMS.MACOSX?n():e.UNKNOWN_VERSION},e.semanticContext=new s((!0)),e.firstLaunchTime=-1,e.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},e.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},e.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},e.REGEX_VERSION="([\\d,.]+)",e.REGEX_VERSION_MAC="([\\d,_,.]+)",e.UNKNOWN_VERSION="Unknown",e.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",e.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",e}();!function(t){t[t.STARTED=0]="STARTED",t[t.ENDED=1]="ENDED"}(t.SessionState||(t.SessionState={}));var u=(t.SessionState,function(){function n(){}return n.initialize=function(t){if(!n._initialized){if(!t)throw new o(1);n._defaultToken=t,n._config.collectorUrl||(n._config.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/"),e.Initialize(n._config),e.Start(),a.initialize(),n._initialized=!0}},n.initializeWithConfiguration=function(t,e){if(!e.collectorUrl)throw new o(4);n._config.collectorUrl=e.collectorUrl,n.initialize(t)},n.flush=function(t){e.Flush(t)},n.addCallbackListener=function(t){n._initialized&&e.AddListener(t)},n.setContext=function(t,e,i){n._contextProperties.setProperty(t,e,i)},n.isInitialized=function(){return n._initialized},n.getDefaultToken=function(){return n._defaultToken},n.getSemanticContext=function(){return n._semanticContext},n.__backToUninitialized=function(){n._config=new t._sender.TelemetryConfig,n._semanticContext=new s((!0)),n._contextProperties=new r,e=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),n._initialized=!1},n._initialized=!1,n._defaultToken=null,n._config=new t._sender.TelemetryConfig,n._contextProperties=new r,n._semanticContext=new s((!0)),n}());t.LogManager=u;var c=function(){function n(e){this._initId=t.datamodels.utils.GetGuid(),this._sequence=0,this._tenantToken=null,this._contextProperties=new r,this._semanticContext=new s((!1)),this._sessionStartTime=0,this._sessionId=null,this._tenantToken=e?e:u.getDefaultToken()}return n.prototype.logEvent=function(t){if(!t.name)throw new o(2);var e=this._createEventRecord(t.name,t.eventType);this._addCustomPropertiesToEvent(e,t),this._sendRecord(e)},n.prototype.logFailure=function(t,e,n,i,r){if(!t)throw new o(5);if(!e)throw new o(6);var s=this._createEventRecord("failure","failure");s.Extension.Add("Failure.Signature",t),s.Extension.Add("Failure.Detail",e),n&&s.Extension.Add("Failure.Category",n),i&&s.Extension.Add("Failure.Id",i),this._addCustomPropertiesToEvent(s,r),this._sendRecord(s)},n.prototype.logPageView=function(t,e,n,i,r,s){if(!t)throw new o(7);if(!e)throw new o(8);var a=this._createEventRecord("pageview","pageview");a.Extension.Add("PageView.Id",t),a.Extension.Add("PageView.Name",e),n&&a.Extension.Add("PageView.Category",n),i&&a.Extension.Add("PageView.Uri",i),r&&a.Extension.Add("PageView.ReferrerUri",r),this._addCustomPropertiesToEvent(a,s),this._sendRecord(a)},n.prototype.logSession=function(e,n){if(0!==e&&1!==e)throw new o(9);var i=this._createEventRecord("session","session");if(0===e){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=t.datamodels.utils.GetGuid(),i.Extension.Add("Session.Id",this._sessionId),i.Extension.Add("Session.State","Started")}else if(1===e){if(0==this._sessionStartTime)return;var r=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);i.Extension.Add("Session.Duration",r.toString()),i.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(r)),i.Extension.Add("Session.Id",this._sessionId),i.Extension.Add("Session.State","Ended"),this._sessionId=null,this._sessionStartTime=0}i.Extension.Add("Session.FirstLaunchTime",this._getISOString(new Date(a.firstLaunchTime))),this._addCustomPropertiesToEvent(i,n),this._sendRecord(i)},n.prototype.getSessionId=function(){return this._sessionId},n.prototype.setContext=function(t,e,n){this._contextProperties.setProperty(t,e,n)},n.prototype.getSemanticContext=function(){return this._semanticContext},n.prototype._getSessionDurationFromTime=function(t){return 0>t?"Undefined":3>=t?"UpTo3Sec":10>=t?"UpTo10Sec":30>=t?"UpTo30Sec":60>=t?"UpTo60Sec":180>=t?"UpTo3Min":600>=t?"UpTo10Min":1800>=t?"UpTo30Min":"Above30Min"},n.prototype._createEventRecord=function(e,n){var i=new t.datamodels.Record;n||(n="custom"),i.EventType=e.toLowerCase(),i.Type=n.toLowerCase(),i.Extension.Add("EventInfo.Source","JS_default_source"),i.Extension.Add("EventInfo.InitId",this._initId),this._sequence++,i.Extension.Add("EventInfo.Sequence",this._sequence.toString()),i.Extension.Add("EventInfo.Name",e.toLowerCase());var r=new Date;return i.Timestamp=t.datamodels.utils.GetTimeStampWithValue(r.getTime()),i.Extension.Add("EventInfo.Time",this._getISOString(r)),i.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+clienttelemetry_build.version),i},n.prototype._getISOString=function(t){function e(t){return 10>t?"0"+t:t.toString()}function n(t){return 10>t?"00"+t:100>t?"0"+t:t.toString()}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"."+n(t.getUTCMilliseconds())+"Z"},n.prototype._addCustomPropertiesToEvent=function(t,e){this._addSemanticContext(t,a.semanticContext),this._addSemanticContext(t,u._semanticContext),this._addSemanticContext(t,this._semanticContext),this._sessionId&&t.Extension.Add("Session.Id",this._sessionId),this._addEventPropertiesToEvent(t,u._contextProperties),this._addEventPropertiesToEvent(t,this._contextProperties),this._addEventPropertiesToEvent(t,e)},n.prototype._addSemanticContext=function(t,e){if(e&&e.contextMap.Count()>0)for(var n=e.contextMap.GetBuffer(),i=0;i<n.length;i++)"UserInfo.Id"==n[i].Key&&0!=e.piiKind?t.AddOrReplacePII(n[i].Key,n[i].Value,e.piiKind):t.Extension.AddOrReplace(n[i].Key,n[i].Value)},n.prototype._addEventPropertiesToEvent=function(e,n){if(n){n.timestamp&&n.timestamp>=new Date("1/1/2000").getTime()&&(e.Timestamp=t.datamodels.utils.GetTimeStampWithValue(n.timestamp),e.Extension.AddOrReplace("EventInfo.Time",this._getISOString(new Date(n.timestamp)))),n.name&&(e.EventType=n.name.toLowerCase(),e.Extension.AddOrReplace("EventInfo.Name",n.name.toLowerCase()));var r=n.properties;if(r&&r.length>0)for(var o=0;o<r.length;o++)r[o].key&&"string"==typeof r[o].key&&(r[o].value||0==r[o].value||0==r[o].value||""==r[o].value)&&(i._isPii(r[o].pii)?(e.AddOrReplacePII(r[o].key,r[o].value.toString(),r[o].pii),e.Extension.Remove(r[o].key)):(e.Extension.AddOrReplace(r[o].key,r[o].value.toString()),e.PIIExtensions.Remove(r[o].key)))}},n.prototype._sendRecord=function(t){u.isInitialized()&&e.SendAsync(this._tenantToken,[t])},n}();t.Logger=c}(t.telemetry||(t.telemetry={}));t.telemetry}(t.applications||(t.applications={}));t.applications}(microsoft||(microsoft={}));