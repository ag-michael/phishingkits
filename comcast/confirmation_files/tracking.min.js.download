/*
 Requires IE9+
 */
!function(e){"use strict";var t={id:"Data Layer",version:3.13,objectPrefix:"tracking-data-",keyPrefix:"data-tracking-",processesPending:0,pageViewCount:0,eventQueue:[],selectors:{sharedData:'script[type="tracking-data"]',parentBlock:"[data-tracking-parent], body",trackingInfo:"[data-tracking]",checkedSelector:'input[type="checkbox"]{0}, input[type="radio"]{0}',checkedAttributeChecked:"data-tracking-checked",checkedAttributeUnChecked:"data-tracking-unchecked",media:"video[data-tracking], audio[data-tracking]"},polyfills:function(){if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),i=t.length;--i>=0&&t.item(i)!==this;);return i>-1}),Element.prototype.closest=Element.prototype.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null},"function"!=typeof window.CustomEvent){var e=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i};e.prototype=window.Event.prototype,window.CustomEvent=e}},initialize:function(){this.polyfills(),this.fullDataType=this.objectPrefix+"digitalData",this.selectors.actionable="a, button",this.selectors.defaultEl=this.selectors.checkedSelector.replace(/\{0}/g,"")+","+this.selectors.actionable+","+this.selectors.media,this.selectors.checkedSelector=this.selectors.checkedSelector.replace(/\{0}/g,this.selectors.trackingInfo),this.selectors.clickElements="a{0}, button{0}".replace(/\{0}/g,this.selectors.trackingInfo),this.selectors.clickElements+=", "+this.selectors.checkedSelector,this.selectors.objectData='script[type^="{0}"]'.replace(/\{0}/g,this.objectPrefix),this.bindListeners(),this.overrideAjax()},debug:function(){if(window.trackingDebug){var e=[].slice.call(arguments);e.unshift(this.id+": "),console.log.apply(this,e)}},mergeOptions:function(t,i,n,a,s,r){if(void 0!==t&&(this.mergeArrays||(i||t).arrayAppend||!e.isArray(t))&&e.isArray(i))return i=i.concat(t)},isJSON:function(t){return"string"==typeof t&&0!==e.trim(t).length&&(t=t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),t=t.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),t=t.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(t))},endTimeOnPage:function(){e.get(window,"digitalData.performance.pageView")&&(window.digitalData.performance.pageView.timeOnPage=Date.now()-window.digitalData.performance.pageView.end),this.triggerEvent(document,"c-tracking-log-page-unload"),e.get(window,"digitalData")&&delete window.digitalData.performance},bindListeners:function(){window.addEventListener("beforeunload",this.endTimeOnPage.bind(this),!1),document.addEventListener("c-tracking-init-start",this.trackInit.bind(this),!1),document.addEventListener("c-tracking-init-styles",this.trackInit.bind(this),!1),document.addEventListener("c-tracking-init-end",this.trackInit.bind(this),!1),document.addEventListener("c-tracking-log",this.customTrack.bind(this),!1),document.addEventListener("c-tracking-log-dom",this.domTrack.bind(this,"dom"),!1),document.addEventListener("c-tracking-process-pending",function(e){this.processesPending++}.bind(this),!1),document.addEventListener("c-tracking-process-complete",function(t){this.processesPending--,this.processesPending<0&&(this.processesPending=0),0===this.processesPending&&this.triggerPage&&(this.pageTrack(t),e.forEach(this.eventQueue,function(e){switch(e.type){case"dom":this.domTrack(e.subtype,e.ev,e.data);break;default:this.trigger(e.payload)}}.bind(this)))}.bind(this),!1),document.addEventListener("c-tracking-log-page",this.pageTrack.bind(this),!1),document.addEventListener("c-tracking-log-page-start",function(){e.get(window,"digitalData.performance")&&(this.endTimeOnPage(),this.pageViewStart=this.pageViewStart||Date.now())}.bind(this),!1),this.bindClickEvents(),this.bindMediaEvents()},bindClickEvents:function(){var e=function(e){if(!e._dlHandled){e._dlHandled=!0;e.target.closest(this.selectors.clickElements)&&this.domTrack("click",e)}}.bind(this);document.addEventListener("click",e,!1);var t=function(){document.removeEventListener("c-tracking-init-end",t,!1),document.body&&(document.removeEventListener("click",e,!1),document.body.addEventListener("click",e,!1))}.bind(this);document.addEventListener("c-tracking-init-end",t,!1),document.addEventListener("c-tracking-unbind-click",function(t){t.target.removeEventListener("click",e,!1)},!1),document.addEventListener("c-tracking-bind-click",function(t){t.target.removeEventListener("click",e,!1),t.target.addEventListener("click",e,!1)},!1)},bindMediaEvents:function(){document.addEventListener("playing",this.trackMediaState.bind(this),!0),document.addEventListener("ended",this.trackMediaState.bind(this),!0),document.addEventListener("pause",this.trackMediaState.bind(this),!0)},triggerEvent:function(e,t,i){var n=new CustomEvent(t,{detail:i,bubbles:!0});try{e.dispatchEvent(n)}catch(e){this.debug("EXCEPTION:",e)}},trackMediaState:function(e){var t=e.target,i={eventAction:e.type},n=!0;if(t.matches(this.selectors.media)){switch(i.timePlayed=t.currentTime,i.duration=t.duration,i.type=t.tagName.toLowerCase(),e.type){case"playing":0===i.timePlayed||"true"===t.getAttribute("isPaused")?t.removeAttribute("isPaused"):n=!1;break;case"pause":i.timePlayed!==i.duration?t.setAttribute("isPaused","true"):n=!1}n&&this.triggerEvent(t,"c-tracking-log-dom",i)}},elementsToJSON:function(t){var i=this.collectJSONfromElements(t),n={eventInfo:{},digitalData:{}};return i.unshift(n),i.push(this.mergeOptions.bind(this)),n=e.mergeWith.apply(this,i)},collectJSONfromElements:function(t){return e.map(t,function(t){var i,n=t.matches("script")?t.innerHTML:t.getAttribute("data-tracking"),a=t.getAttribute("type"),s={eventInfo:{},digitalData:{}},r=this.isJSON(n);if(r&&(i=JSON.parse(n),e.isObject(i)||(r=!1,i=null)),r||""===e.trim(n)||this.debug("Warning - Invalid JSON found: \n",n,"\nElement:\n",t),t.matches(this.selectors.objectData)){var o={};if(a===this.fullDataType)o=e.merge({},o,i,this.mergeOptions.bind(this));else{var c=a.replace(new RegExp("^"+this.objectPrefix),"");o[c]=i,t.matches("script")&&t.hasAttribute("data-tracking-append")&&(o[c].arrayAppend=!0)}s.digitalData=o}else i&&(s.eventInfo=i);var d=t.attributes;if(d)for(var g,h,l=d.length;l--;)d[l]&&(g=d[l].name,e.startsWith(g,this.keyPrefix)&&!e.includes([this.selectors.checkedAttributeChecked,this.selectors.checkedAttributeUnChecked],g)&&(h=t.getAttribute(g),this.isJSON(h)?s.digitalData[g.replace(new RegExp("^"+this.keyPrefix),"")]=JSON.parse(h):""!==e.trim(h)&&this.debug("Warning - Invalid JSON found: \n",h,"\nElement:\n",t,"\nAttribute:\n",g)));return s.digitalData.event&&s.digitalData.event.length&&(s.eventInfo=e.merge({},s.digitalData.event[0],s.eventInfo,this.mergeOptions.bind(this)),delete s.digitalData.event),s}.bind(this))},gatherAncestorsUntil:function(e,t,i){return void 0===i?i=[]:e!==t&&i.push(e),e!==t?this.gatherAncestorsUntil(e.parentNode,t,i):i},domTrack:function(t,i){if(this.processesPending>0&&this.triggerPage)return void this.eventQueue.push({type:"dom",subtype:t,ev:{target:i.target,detail:i.detail,type:i.type},data:s});var n,a=i.target,s=i.detail,r=a.closest(this.selectors.parentBlock),o=[],c=s&&s.$related;if(s&&delete s.$related,c&&Array.prototype.push.apply(o,c.toArray()),Array.prototype.push.apply(o,Array.prototype.filter.call(r.children,function(e){return e.matches(this.selectors.sharedData)}.bind(this))),r.matches(this.selectors.trackingInfo)&&o.push(r),Array.prototype.push.apply(o,this.gatherAncestorsUntil(a,r).filter(function(e){return e.matches(this.selectors.trackingInfo)}.bind(this)).reverse()),a.matches(this.selectors.trackingInfo)&&(o.push(a),!c)){var d=a.getAttribute("data-tracking");this.isJSON(d)?(d=JSON.parse(d),c=d&&d.$related):""!==e.trim(d)&&this.debug("Warning - Invalid JSON found: \n",d,"\nElement:\n",a)}if(this.mergeArrays=!0,n=this.elementsToJSON(o),s&&(s.event?(e.merge(n.eventInfo,s.event[0],this.mergeOptions.bind(this)),delete s.event,e.merge(n.digitalData,s,this.mergeOptions.bind(this))):e.merge(n.eventInfo,s,this.mergeOptions.bind(this))),a.matches(this.selectors.checkedSelector)){var g=a.matches(":checked")?a.getAttribute(this.selectors.checkedAttributeChecked):a.getAttribute(this.selectors.checkedAttributeUnChecked);this.isJSON(g)?(g=JSON.parse(g),e.merge(n.eventInfo,g,this.mergeOptions.bind(this))):""!==e.trim(g)&&this.debug("Warning - Invalid JSON found: \n",g,"\nElement:\n",a,"\nIs Checked:\n",a.matches(":checked"))}this.setDefaultEventValues(n,i,a),this.mergeArrays=!1,this.trigger({data:n,trigger:a,type:t})},setDefaultEventValues:function(t,i,n){var a=n.closest(this.selectors.defaultEl)||n,s=(a.tagName||a.nodeName||"").toLowerCase();if(void 0===t.eventInfo.type&&(t.eventInfo.type=i.type),void 0===t.eventInfo.eventName&&(t.eventInfo.eventName=s+(a.type?"[type='"+a.type.toLowerCase()+"'] ":" ")+i.type),void 0===t.eventInfo.eventAction){var r=null;a.matches(this.selectors.checkedSelector)?(r="Name:"+a.getAttribute("name"),r+=", Value:"+a.value,r+=a.matches(":checked")?", :checked":", :unchecked"):a.matches(this.selectors.media)?r=i.type:a.matches(this.selectors.actionable)&&(r=e.trim(a.innerText)),null!==r&&(t.eventInfo.eventAction=r)}a.matches(this.selectors.media)&&void 0===t.eventInfo[s+"Name"]&&(t.eventInfo[s+"Name"]=(a.src||a.currentSrc||(a.querySelector("source")||{}).src||"UNKNOWN").toLowerCase()),void 0!==t.eventInfo.eventPage&&""!==t.eventInfo.eventPage||(t.eventInfo.eventPage=e.get(window,"digitalData.page.pageInfo.pageName")),void 0===t.eventInfo.eventMethod&&a.matches(this.selectors.media)&&(t.eventInfo.eventMethod=s+"-Track")},trackInit:function(e){var t=e&&e.target?e.target.querySelectorAll(this.selectors.objectData):document.querySelectorAll(this.selectors.objectData),i=this.elementsToJSON(t);this.trigger({data:i,trigger:e&&e.target,type:e.type.toLowerCase()})},pageTrack:function(t){if(this.processesPending>0)return void(this.triggerPage=!0);this.triggerPage=!1;var i=t&&t.target?t.target.querySelectorAll(this.selectors.objectData):document.querySelectorAll(this.selectors.objectData),n=t.detail||{},a=this.elementsToJSON(i);e.merge(a,{digitalData:n},this.mergeOptions.bind(this)),this.trigger({data:a,trigger:t&&t.target,type:"page"})},customTrack:function(e){this.trigger({data:e.detail,trigger:e.target,type:"custom"})},trigger:function(e){if(this.processesPending>0&&e.data&&this.triggerPage)return void this.eventQueue.push({type:"trigger",payload:e});e.trigger=e.trigger||document,e.data=e.data||{},this.setDataLayer(e.trigger,e),this.debug("\ndigitalData Object: ",window.digitalData,"\ndigitalData Value:\n",JSON.stringify(window.digitalData,null,2)),this.triggerEvent(e.trigger,"c-tracking-trigger",e)},overrideAjax:function(){var i=XMLHttpRequest.prototype;i._open=i.open,i.open=function(e,n){t.trackAjax(this._perf={url:n,method:e}),i._open.apply(this,arguments)},i._send=i.send,i.send=function(){this._perf||t.trackAjax(this._perf={method:"UNKNOWN"});var n=function(t){this._perf&&(this._perf.url||(this._perf.url=this.responseURL),this._perf.requestEnd=Date.now(),e.isNumber(this._perf.requestStart)&&(this._perf.requestMS=this._perf.requestEnd-this._perf.requestStart),this._perf.type=t.type,this._perf.status=this.status,this._perf.eventMethod="c-tracking-ajax")};this._perf.requestStart=Date.now(),this.addEventListener("load",n),this.addEventListener("error",n),this.addEventListener("abort",n),this.addEventListener("timeout",n),i._send.apply(this,arguments)}},trackAjax:function(t){e.get(window,"digitalData.performance.ajax")?window.digitalData.performance.ajax.push(t):(this.ajaxPerfQ=this.ajaxPerfQ||[],this.ajaxPerfQ.push(t))},customAssign:function(t,i,n,a,s){return e.isArray(i)?e.omitBy(e.map(i,function(t){return e.isPlainObject(t)?e.omitBy(e.assignInWith({},t,this.customAssign.bind(this)),e.isNil):e.isNumber(t)&&0!==t||e.isString(t)?t:null}.bind(this)),e.isNil):e.isPlainObject(i)?e.omitBy(e.assignInWith({},i,this.customAssign.bind(this)),e.isNil):e.isNumber(i)&&0!==i||e.isString(i)?i:null},pagePerf:function(t){window.performance&&(t.performance=this.performance||(this.performance={timing:e.omitBy(e.assignInWith({},window.performance.timing,this.customAssign.bind(this)),e.isNil),navigation:e.omitBy(e.assignInWith({},window.performance.navigation,this.customAssign.bind(this)),e.isNil)})),t.performance=t.performance||{},t.performance.ajax=this.ajaxPerfQ||[],delete this.ajaxPerfQ;var i=this.pageViewStart||(t.performance.timing||{}).requestStart,n=Date.now();t.performance.pageView={start:i,end:n,count:this.pageViewCount},this.pageViewCount>0&&!this.pageViewStart?(t.performance.pageView.start=null,t.performance.pageView.invalidStartTime=!0):t.performance.pageView.ms=n-i,delete this.pageViewStart},browserInfo:function(t){var i=void 0===this.navigatorInfo;t.browserInfo={navigator:i?this.navigatorInfo=e.omitBy(e.assignInWith({},window.navigator,this.customAssign.bind(this)),e.isNil):this.navigatorInfo,screen:e.omitBy(e.assignInWith({},window.screen,this.customAssign.bind(this)),e.isNil),window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight,outerWidth:window.outerWidth,outerHeight:window.outerHeight,devicePixelRatio:window.devicePixelRatio},location:e.omitBy(e.assignInWith({},window.location,this.customAssign.bind(this)),e.isNil)},i&&(delete this.navigatorInfo.languages,e.set(t,"browserInfo.navigator.plugins",e.map(e.get(window,"navigator.plugins"),function(t){return e.omitBy(e.assignInWith({},t,this.customAssign.bind(this)),e.isNil)}.bind(this))))},setDataLayer:function(t,i){var n=i.data,a={version:this.version,plugins:[]};this.triggerEvent(t,"c-tracking-load-defaults",a);var s=Object.keys(a.plugins).filter(function(e){return isNaN(parseInt(e,10))});s.length&&this.debug("One or more invalid plugins detected:\n ",s),"page"===i.type?(this.pagePerf(a),this.browserInfo(a),a.timeStamp=a.timeStamp||new Date,window.digitalData=a,this.pageViewCount++):window.digitalData=window.digitalData||a,e.merge(window.digitalData,n.digitalData,this.mergeOptions.bind(this)),window.digitalData.event=window.digitalData.event||[],e.size(n.eventInfo)&&(n.eventInfo.timeStamp=n.eventInfo.timeStamp||new Date,window.digitalData.event.push({eventInfo:n.eventInfo})),window.digitalData.schemaVersion>=.1&&e.set(window.digitalData,"page.pageInfo.pageName",this.buildPageName())},buildPageName:function(){var t=[],i=window.digitalData;return t.push(e.get(i,"page.category.businessType")),t.push(e.get(i,"page.category.siteType")),t.push(e.get(i,"page.category.primaryCategory")),t.push(e.get(i,"page.category.subCategory1")),t.push(e.get(i,"page.pageInfo.screenName")),t.join("|")}};t.initialize()}(window._dl||window._);